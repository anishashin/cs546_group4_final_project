// IN PROGRESS (please do not edit this file) - Anisha

(function($) {
    let counter = 1;

    $('#addFoodButton').on('click', function(event) {
        event.preventDefault();
        let foodDropdown =
        `<div class="row">
            <div class="col-8">
                <select id="food${counter}" class="form-select" aria-label="Select Food">`;
        foodDropdown += $('#foodDropdownTemplate').html();
        foodDropdown +=
                `</select>
            </div>
            <div class="col-4">
                <label for="servings${counter}" class="visually-hidden">Number of Servings</label>
                <input id="servings${counter}" class="form-control" placeholder="Number of Servings">
            </div>
        </div><br>`;
        $('#foodDiv').append(foodDropdown);
        counter += 1;
    });

    $('#foodDiv').on('keyup change', function(event) {
        event.preventDefault();
        calculate();
    });
    
    function calculate() {
        let totalCalories = 0;
        let totalFat = 0;
        let totalCarbs = 0;
        let totalProtein = 0;
        for(let i = 1; i < counter; i++) {
            let foodId = $(`#food${i}`).val();
            let servings = parseFloat($(`#servings${i}`).val());
            if((foodId && typeof foodId === 'string' && foodId.trim() !== '' && foodId !== 'Select a food') 
                && (servings && typeof servings === 'number' && !isNaN(servings) && servings > 0)) {
                var requestConfig = {
                    method: 'GET',
                    url: '/foods/json/' + foodId
                };
                $.ajax(requestConfig).then(function(response) {
                    totalCalories += response.food.calories * servings;
                    totalFat += response.food.fat * servings;
                    totalCarbs += response.food.carbs * servings;
                    totalProtein += response.food.protein * servings;
                    $('#totalCalories').html(Math.round(totalCalories * 10) / 10);
                    $('#totalFat').html(Math.round(totalFat * 10) / 10);
                    $('#totalCarbs').html(Math.round(totalCarbs * 10) / 10);
                    $('#totalProtein').html(Math.round(totalProtein * 10) / 10);
                });
            }
        }
    }

})(window.jQuery);